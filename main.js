(()=>{"use strict";function t(){return fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me",{headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}})}var e=document.querySelector(".elements"),n=document.querySelector("#card-template").content;function o(t,e,o,r,c,a){var i=n.querySelector(".element").cloneNode(!0),s=i.querySelector(".element__image");return i.id="_".concat(t),s.src=o,s.alt=e,i.querySelector(".element__heading").textContent=e,i.querySelector(".element__like-counter").textContent=r,c||i.querySelector(".btn_style_delete").remove(),a&&i.querySelector(".btn_style_like").classList.add("btn_style_like-active"),s.addEventListener("click",(function(){return function(t,e){C.src=e,C.alt=t,g.textContent=t,j(L)}(e,o)})),i}function r(t){e.prepend(t)}var c=document.querySelectorAll(".popup"),a=document.querySelector(".profile__name"),i=document.querySelector(".profile__vocation"),s=document.querySelector(".popup_action_edit-profile"),l=document.querySelector(".btn_style_edit"),u=document.forms.profileEdit,d=u.elements.submit,f=document.querySelector(".popup_action_edit-avatar"),p=document.querySelector(".profile__avatar-wrap"),m=document.querySelector(".profile__avatar"),y=document.forms.editAvatar,h=y.elements.submit,_=document.querySelector(".popup_action_add-card"),v=document.querySelector(".btn_style_add"),b=document.forms.cardAdd,S=b.querySelector(".btn_style_submit"),L=document.querySelector(".popup_action_show-card"),C=L.querySelector(".popup__image"),g=L.querySelector(".popup__figcaption"),k=document.querySelector(".popup_action_delete-confirmation"),q=k.querySelector(".btn_style_submit");function E(t){t.classList.remove("popup_opened"),window.removeEventListener("keyup",T)}function j(t){t.classList.add("popup_opened"),window.addEventListener("keyup",T)}function T(t){if("Escape"===t.key){var e=document.querySelector(".popup_opened");e&&E(e)}}function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}var w,P=document.querySelector(".profile__avatar");l.addEventListener("click",(function(){u.profileName.value=a.textContent,u.profileVocation.value=i.textContent,j(s)})),v.addEventListener("click",(function(){return j(_)})),u.addEventListener("submit",(function(t){var e,n;t.preventDefault(),d.textContent="Сохранение...",(e=u.profileName.value,n=u.profileVocation.value,fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me",{method:"PATCH",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({name:e,about:n})})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){a.textContent=t.name,i.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){d.textContent="Сохранить"})),E(s),u.reset()})),p.addEventListener("click",(function(){y.elements.avatarLink.value=m.src,j(f)})),y.addEventListener("submit",(function(t){var e;t.preventDefault(),h.textContent="Сохранение...",(e=y.elements.avatarLink.value,fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me/avatar ",{method:"PATCH",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({avatar:e})})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){m.src=t.avatar})).catch((function(t){console.log(t)})).finally((function(){h.textContent="Сохранить"})),E(f),y.reset()})),c.forEach((function(t){t.addEventListener("mousedown",(function(t){!function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__btn-close"))&&E(t.target.closest(".popup"))}(t)}))})),t().then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){a.textContent=t.name,i.textContent=t.about,P.src=t.avatar})).catch((function(t){console.log(t)})),fetch("https://nomoreparties.co/v1/plus-cohort-21/cards",{headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){t().then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){e.forEach((function(e){r(o(e._id,e.name,e.link,e.likes.length,t._id===e.owner._id))}))})).catch((function(t){console.log(t)}))})).catch((function(t){console.log(t)})),b.addEventListener("submit",(function(t){var e,n;t.preventDefault(),(e=b.placeName.value,n=b.placeLink.value,fetch("https://nomoreparties.co/v1/plus-cohort-21/cards",{method:"POST",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({name:e,link:n})})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){r(o(t._id,t.name,t.link,t.likes.length,!0))})).catch((function(t){console.log(t)})),E(_),b.reset(),console.log(S),S.disabled=!0,S.classList.add("btn_disabled")})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("btn_style_delete")&&(q.setAttribute("data-card-id",t.target.closest(".element").id),j(k))})),q.addEventListener("mousedown",(function(t){var n,o=t.target.dataset.cardId.replace("_","");q.textContent="Удаление..",q.disabled=!0,q.classList.add("btn_disabled"),(n=o,fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/".concat(n),{method:"DELETE",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){!function(t){e.querySelector("#_".concat(t)).remove()}(o),E(k)})).catch((function(t){console.log(t)})).finally((function(){q.textContent="Да",q.disabled=!1,q.classList.remove("btn_disabled")}))})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("btn_style_like")&&(t.target.classList.contains("btn_style_like-active")?function(t){if(t.target.classList.contains("btn_style_like")){var e=t.target,n=t.target.closest(".element"),o=n.id.replace("_","");e.style.visibility="hidden",function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}})}(o).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){t.target.classList.remove("btn_style_like-active"),n.querySelector(".element__like-counter").textContent=e.likes.length})).catch((function(t){console.log(t)})).finally((function(){e.style.visibility="visible"}))}}(t):function(t){if(t.target.classList.contains("btn_style_like")){var e=t.target,n=t.target.closest(".element"),o=n.id.replace("_","");e.style.visibility="hidden",function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}})}(o).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){t.target.classList.add("btn_style_like-active"),n.querySelector(".element__like-counter").textContent=e.likes.length})).catch((function(t){console.log(t)})).finally((function(){e.style.visibility="visible"}))}}(t))})),"object"===x(w={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".btn_style_submit",inactiveButtonClass:"btn_disabled",inputErrorClass:"form__input_error",errorClass:"form__input-error"})&&document.querySelectorAll(w.formSelector).forEach((function(t){!function(t,e){t.querySelectorAll(e.inputSelector).forEach((function(n){n.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?(function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove("".concat(n.errorClass,"_visible")),o.textContent=""}(t,e,n),function(t,e){var n=t.querySelector(e.submitButtonSelector);n.classList.remove(e.inactiveButtonClass),n.disabled=!1}(t,n)):(function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.classList.add("".concat(o.errorClass,"_visible")),r.textContent=n}(t,e,e.validationMessage,n),function(t,e){var n=t.querySelector(e.submitButtonSelector);n.classList.add(e.inactiveButtonClass),n.disabled=!0}(t,n))}(t,n,e)}))}))}(t,w)})),window.addEventListener("load",(function(){document.querySelectorAll(".popup").forEach((function(t){t.style.display="flex"}))}))})();