(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var e=document.querySelector(".profile__avatar");function n(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function o(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.textContent=t?o:n}function r(t,e,n){e.preventDefault();var r=e.submitter,a=r.textContent;o(!0,r,a,n),t().then((function(t){e.target.reset()})).catch((function(t){console.log(t)})).finally((function(){o(!1,r,a)}))}var a=document.querySelector(".elements"),i=document.querySelector("#card-template").content;function c(t,e,n,o,r,a){var c=i.querySelector(".element").cloneNode(!0),s=c.querySelector(".element__image");return c.setAttribute("data-card-id",t),s.src=n,s.alt=e,c.querySelector(".element__heading").textContent=e,c.querySelector(".element__like-counter").textContent=o,r||c.querySelector(".btn_style_delete").remove(),a&&c.querySelector(".btn_style_like").classList.add("btn_style_like-active"),s.addEventListener("click",(function(){return function(t,e){q.src=e,q.alt=t,k.textContent=t,j(C)}(e,n)})),c}function s(t){a.prepend(t)}var l,u=document.querySelectorAll(".popup"),d=document.querySelector(".profile__name"),f=document.querySelector(".profile__vocation"),p=document.querySelector(".popup_action_edit-profile"),m=document.querySelector(".btn_style_edit"),y=document.forms.profileEdit,v=(y.elements.submit,document.querySelector(".popup_action_edit-avatar")),h=document.querySelector(".profile__avatar-wrap"),_=document.querySelector(".profile__avatar"),b=document.forms.editAvatar,S=document.querySelector(".popup_action_add-card"),g=document.querySelector(".btn_style_add"),L=document.forms.cardAdd,C=document.querySelector(".popup_action_show-card"),q=C.querySelector(".popup__image"),k=C.querySelector(".popup__figcaption"),E=document.querySelector(".popup_action_delete-confirmation"),T=(E.querySelector(".btn_style_submit"),document.forms.cardDelete);function x(t){t.classList.remove("popup_opened"),window.removeEventListener("keyup",w)}function j(t){t.classList.add("popup_opened"),window.addEventListener("keyup",w)}function w(t){if("Escape"===t.key){var e=document.querySelector(".popup_opened");e&&x(e)}}function A(t){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(t)}m.addEventListener("click",(function(){y.profileName.value=d.textContent,y.profileVocation.value=f.textContent,j(p)})),g.addEventListener("click",(function(){return j(S)})),y.addEventListener("submit",(function(t){r((function(){return(t=y.profileName.value,e=y.profileVocation.value,fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me",{method:"PATCH",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({name:t,about:e})}).then(n)).then((function(t){d.textContent=t.name,f.textContent=t.about,x(p),y.reset()}));var t,e}),t)})),h.addEventListener("click",(function(){b.elements.avatarLink.value=_.src,j(v)})),b.addEventListener("submit",(function(t){r((function(){return(t=b.elements.avatarLink.value,fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me/avatar ",{method:"PATCH",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({avatar:t})}).then(n)).then((function(t){_.src=t.avatar,x(v)}));var t}),t)})),T.addEventListener("submit",(function(t){var e=T.elements.cardId.value;r((function(){return(t=e,fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/".concat(t),{method:"DELETE",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}}).then(n)).then((function(t){!function(t){a.querySelector('.element[data-card-id="'.concat(t,'"]')).remove()}(e),x(E)}));var t}),t,"Удаление...")})),L.addEventListener("submit",(function(t){r((function(){return(t=L.placeName.value,e=L.placeLink.value,fetch("https://nomoreparties.co/v1/plus-cohort-21/cards",{method:"POST",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"},body:JSON.stringify({name:t,link:e})}).then(n)).then((function(t){s(c(t._id,t.name,t.link,t.likes.length,!0)),x(S)}));var t,e}),t)})),a.addEventListener("mousedown",(function(t){t.target.classList.contains("btn_style_delete")&&(T.elements.cardId.value=t.target.closest(".element").dataset.cardId,j(E))})),a.addEventListener("mousedown",(function(t){t.target.classList.contains("btn_style_like")&&(t.target.classList.contains("btn_style_like-active")?function(t){if(t.target.classList.contains("btn_style_like")){var e=t.target,o=t.target.closest(".element"),r=o.dataset.cardId;e.style.visibility="hidden",function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}}).then(n)}(r).then((function(e){t.target.classList.remove("btn_style_like-active"),o.querySelector(".element__like-counter").textContent=e.likes.length})).catch((function(t){console.log(t)})).finally((function(){e.style.visibility="visible"}))}}(t):function(t){if(t.target.classList.contains("btn_style_like")){var e=t.target,o=t.target.closest(".element"),r=o.dataset.cardId;e.style.visibility="hidden",function(t){return fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}}).then(n)}(r).then((function(e){t.target.classList.add("btn_style_like-active"),o.querySelector(".element__like-counter").textContent=e.likes.length})).catch((function(t){console.log(t)})).finally((function(){e.style.visibility="visible"}))}}(t))})),u.forEach((function(t){t.addEventListener("mousedown",(function(t){!function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__btn-close"))&&x(t.target.closest(".popup"))}(t)}))})),Promise.all([fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me",{headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}}).then(n),fetch("https://nomoreparties.co/v1/plus-cohort-21/cards",{headers:{authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"}}).then(n)]).then((function(n){var o,r,a=(r=2,function(t){if(Array.isArray(t))return t}(o=n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,a,i,c=[],s=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;s=!1}else for(;!(s=(o=a.call(n)).done)&&(c.push(o.value),c.length!==e);s=!0);}catch(t){l=!0,r=t}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw r}}return c}}(o,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}(o,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],l=a[1];d.textContent=i.name,f.textContent=i.about,e.src=i.avatar,l.forEach((function(t){var e=c(t._id,t.name,t.link,t.likes.length,i._id===t.owner._id,function(t,e){if(e)for(var n=0;n<e.length;n++)if(t._id===e[n]._id)return!0;return!1}(i,t.likes));s(e)}))})).catch((function(t){console.log(t)})),"object"===A(l={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".btn_style_submit",inactiveButtonClass:"btn_disabled",inputErrorClass:"form__input_error",errorClass:"form__input-error"})&&document.querySelectorAll(l.formSelector).forEach((function(t){!function(t,e){t.querySelectorAll(e.inputSelector).forEach((function(n){n.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?(function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove("".concat(n.errorClass,"_visible")),o.textContent=""}(t,e,n),function(t,e){var n=t.querySelector(e.submitButtonSelector);n.classList.remove(e.inactiveButtonClass),n.disabled=!1}(t,n)):(function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.classList.add("".concat(o.errorClass,"_visible")),r.textContent=n}(t,e,e.validationMessage,n),function(t,e){var n=t.querySelector(e.submitButtonSelector);n.classList.add(e.inactiveButtonClass),n.disabled=!0}(t,n))}(t,n,e)}))}))}(t,l)})),window.addEventListener("load",(function(){document.querySelectorAll(".popup").forEach((function(t){t.style.display="flex"}))}))})();