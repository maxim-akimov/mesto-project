(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var e=document.querySelector(".profile__avatar");function n(t,e){return fetch(t,e).then(o)}function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function r(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.textContent=t?o:n}function i(t,e,n){e.preventDefault();var o=e.submitter,i=o.textContent;r(!0,o,i,n),t().then((function(t){e.target.reset()})).catch((function(t){console.log(t)})).finally((function(){r(!1,o,i)}))}var a={authorization:"f07db228-d9f6-44b3-81fa-e5425e2f6a35","Content-Type":"application/json; charset=UTF-8"},c=document.querySelector(".elements"),l=document.querySelector("#card-template").content;function s(t,e,n,o,r,i){var a=l.querySelector(".element").cloneNode(!0),c=a.querySelector(".element__image");return a.setAttribute("data-card-id",t),c.src=n,c.alt=e,a.querySelector(".element__heading").textContent=e,a.querySelector(".element__like-counter").textContent=o,r||a.querySelector(".btn_style_delete").remove(),i&&a.querySelector(".btn_style_like").classList.add("btn_style_like-active"),c.addEventListener("click",(function(){return function(t,e){C.src=e,C.alt=t,x.textContent=t,T(E)}(e,n)})),a}function u(t){c.prepend(t)}var d,f=document.querySelectorAll(".popup"),p=document.querySelector(".profile__name"),m=document.querySelector(".profile__vocation"),y=document.querySelector(".popup_action_edit-profile"),v=document.querySelector(".btn_style_edit"),_=document.forms.profileEdit,h=(_.elements.submit,document.querySelector(".popup_action_edit-avatar")),b=document.querySelector(".profile__avatar-wrap"),S=document.querySelector(".profile__avatar"),g=document.forms.editAvatar,L=document.querySelector(".popup_action_add-card"),q=document.querySelector(".btn_style_add"),k=document.forms.cardAdd,E=document.querySelector(".popup_action_show-card"),C=E.querySelector(".popup__image"),x=E.querySelector(".popup__figcaption"),w=document.querySelector(".popup_action_delete-confirmation"),A=(w.querySelector(".btn_style_submit"),document.forms.cardDelete);function j(t){t.classList.remove("popup_opened"),window.removeEventListener("keyup",I)}function T(t){t.classList.add("popup_opened"),window.addEventListener("keyup",I)}function I(t){if("Escape"===t.key){var e=document.querySelector(".popup_opened");e&&j(e)}}function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}v.addEventListener("click",(function(){_.profileName.value=p.textContent,_.profileVocation.value=m.textContent,T(y)})),q.addEventListener("click",(function(){return T(L)})),_.addEventListener("submit",(function(t){i((function(){return(t=_.profileName.value,e=_.profileVocation.value,n("https://nomoreparties.co/v1/plus-cohort-21/users/me",{method:"PATCH",headers:a,body:JSON.stringify({name:t,about:e})})).then((function(t){p.textContent=t.name,m.textContent=t.about,j(y),_.reset()}));var t,e}),t)})),b.addEventListener("click",(function(){g.elements.avatarLink.value=S.src,T(h)})),g.addEventListener("submit",(function(t){i((function(){return(t=g.elements.avatarLink.value,n("https://nomoreparties.co/v1/plus-cohort-21/users/me/avatar",{method:"PATCH",headers:a,body:JSON.stringify({avatar:t})})).then((function(t){S.src=t.avatar,j(h)}));var t}),t)})),A.addEventListener("submit",(function(t){var e=A.elements.cardId.value;i((function(){return(t=e,n("https://nomoreparties.co/v1/plus-cohort-21/cards/".concat(t),{method:"DELETE",headers:a})).then((function(t){!function(t){c.querySelector('.element[data-card-id="'.concat(t,'"]')).remove()}(e),j(w)}));var t}),t,"Удаление...")})),k.addEventListener("submit",(function(t){i((function(){return(t=k.placeName.value,e=k.placeLink.value,n("https://nomoreparties.co/v1/plus-cohort-21/cards",{method:"POST",headers:a,body:JSON.stringify({name:t,link:e})})).then((function(t){u(s(t._id,t.name,t.link,t.likes.length,!0)),j(L)}));var t,e}),t)})),c.addEventListener("mousedown",(function(t){t.target.classList.contains("btn_style_delete")&&(A.elements.cardId.value=t.target.closest(".element").dataset.cardId,T(w))})),c.addEventListener("mousedown",(function(t){t.target.classList.contains("btn_style_like")&&(t.target.classList.contains("btn_style_like-active")?function(t){if(t.target.classList.contains("btn_style_like")){var e=t.target,o=t.target.closest(".element"),r=o.dataset.cardId;e.style.visibility="hidden",function(t){return n("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"DELETE",headers:a})}(r).then((function(e){t.target.classList.remove("btn_style_like-active"),o.querySelector(".element__like-counter").textContent=e.likes.length})).catch((function(t){console.log(t)})).finally((function(){e.style.visibility="visible"}))}}(t):function(t){if(t.target.classList.contains("btn_style_like")){var e=t.target,o=t.target.closest(".element"),r=o.dataset.cardId;e.style.visibility="hidden",function(t){return n("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"PUT",headers:a})}(r).then((function(e){t.target.classList.add("btn_style_like-active"),o.querySelector(".element__like-counter").textContent=e.likes.length})).catch((function(t){console.log(t)})).finally((function(){e.style.visibility="visible"}))}}(t))})),f.forEach((function(t){t.addEventListener("mousedown",(function(t){!function(t){(t.target.classList.contains("popup_opened")||t.target.classList.contains("popup__btn-close"))&&j(t.target.closest(".popup"))}(t)}))})),Promise.all([n("https://nomoreparties.co/v1/plus-cohort-21/users/me",{headers:a}),n("https://nomoreparties.co/v1/plus-cohort-21/cards",{headers:a})]).then((function(n){var o,r,i=(r=2,function(t){if(Array.isArray(t))return t}(o=n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,c=[],l=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=i.call(n)).done)&&(c.push(o.value),c.length!==e);l=!0);}catch(t){s=!0,r=t}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return c}}(o,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}(o,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=i[0],c=i[1];p.textContent=a.name,m.textContent=a.about,e.src=a.avatar,c.forEach((function(t){var e=s(t._id,t.name,t.link,t.likes.length,a._id===t.owner._id,function(t,e){if(e)for(var n=0;n<e.length;n++)if(t._id===e[n]._id)return!0;return!1}(a,t.likes));u(e)}))})).catch((function(t){console.log(t)})),"object"===O(d={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".btn_style_submit",inactiveButtonClass:"btn_disabled",inputErrorClass:"form__input_error",errorClass:"form__input-error"})&&document.querySelectorAll(d.formSelector).forEach((function(t){!function(t,e){t.querySelectorAll(e.inputSelector).forEach((function(n){n.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?(function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove("".concat(n.errorClass,"_visible")),o.textContent=""}(t,e,n),function(t,e){var n=t.querySelector(e.submitButtonSelector);n.classList.remove(e.inactiveButtonClass),n.disabled=!1}(t,n)):(function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.classList.add("".concat(o.errorClass,"_visible")),r.textContent=n}(t,e,e.validationMessage,n),function(t,e){var n=t.querySelector(e.submitButtonSelector);n.classList.add(e.inactiveButtonClass),n.disabled=!0}(t,n))}(t,n,e)}))}))}(t,d)})),window.addEventListener("load",(function(){document.querySelectorAll(".popup").forEach((function(t){t.style.display="flex"}))}))})();